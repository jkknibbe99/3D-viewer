
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>STL Viewer</title>
    
    <!-- Bootstrap CSS -->
    <link href="./css/bootstrap.css" rel="stylesheet">

    <!-- Imbedded style -->
    <style>
        body {
            margin: 0;
        }

        #file-select-form {
            position: fixed;
            text-align: center;
        }
    </style>

    <!-- Import maps -->
    <!-- <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
            }
        }
    </script> -->
    <script type="importmap">
        {
            "imports": {
                "three": "./js/three.js"
            }
        }
    </script>

    <!-- jQuery -->
    <script src="./js/jquery-3.7.0.min.js"></script>
</head>

<body>
    <form id="file-select-form" class="p-3">
        <select id="file-select" class="form-select" name="filename">
            <option>...</option>
        </select>
    </form>
    <script>
        // onchange submit
        $('#file-select').on('change', function () {
            $('#file-select-form').submit();
        })

        // Get filename
        const urlParams = new URLSearchParams(window.location.search);
        const filename = urlParams.get('filename')

        if (!filename || filename == '...') {
            $('#file-select-form').css('margin-left', 'calc(50vw - 100px)');
            $('#file-select-form').css('width', '200px');
            $('#file-select-form').prepend('<label for="file-select" class="pb-2"><strong>Select a file to view</strong></label>');
        }

        // get public files
        $.get('/public').then((resp) => {
            const regexp = /\/public\/([0-9a-zA-Z_\-. ]+\.[0-9a-zA-Z]+)/g;
            const matches = [...resp.matchAll(regexp)]
            let filenames = [];
            for (let i = 0; i < matches.length; i++) {
                filenames.push(matches[i][1]);
            }
            // Add option elems to file-select
            for (let i = 0; i < filenames.length; i++) {
                $('#file-select').html($('#file-select').html() + '<option>' + filenames[i] + '</option>');
            }
            // Set selected file
            $('#file-select option').each(function(index) {
                if ($(this).clone().children().remove().end().text() == filename) {
                    $(this).prop('selected', true);
                }

            });
        });

        
    </script>
    <script type="module" src="./js/main.js"></script>
</body>

</html>